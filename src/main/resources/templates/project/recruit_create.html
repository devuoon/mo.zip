<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8"/>
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
  <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
  <title>ëª¨ì§‘(mo.zip) - ë©¤ë²„ëª¨ì§‘ ì‘ì„±</title>
  <!-- font awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer"/>
  <!-- ì§ì ‘ êµ¬í˜„í•œ CSS -->
  <link rel="stylesheet" th:href="@{/css/reset.css}"/>
  <link rel="stylesheet" th:href="@{/css/common.css}"/>
  <link rel="stylesheet" th:href="@{/css/index.css}"/>
  <link rel="stylesheet" th:href="@{/css/create.css}"/>
  <!-- js -->
  <!-- jquery -->
  <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
          crossorigin="anonymous"></script>

  <script defer th:src="@{/js/dynamicSkills.js}"></script>
  <script th:src="@{/js/common.js}"></script>
  <!-- favicon -->
  <link rel="icon" th:href="@{/img/favicon.ico}">
</head>
<body>
<header id="header">
  <th:block th:replace="~{fragment/header}"></th:block>
</header>
<main>
  <div class="wrap flex">
    <div class="rc-input">
      <form id="createProject">
        <!--        <span class="pj-type pj">ì‚¬ì´ë“œ í”„ë¡œì íŠ¸</span>-->
        <select name="projectType" class="project-type">
          <option value="ì‚¬ì´ë“œ í”„ë¡œì íŠ¸">ì‚¬ì´ë“œ í”„ë¡œì íŠ¸</option>
          <option value="ëª¨ì§‘/ìŠ¤í„°ë””">ëª¨ì§‘/ìŠ¤í„°ë””</option>
        </select>
        <input class="rc-title" type="text" name="projectName" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="50"/>
        <div class="rc-summarize">
          <p class="s-title">ì£¼ì œ</p>
          <textarea id="subject" name="subject" rows="1" cols="20" placeholder="ì£¼ì œë¥¼ í•œ ì¤„ ì´ë‚´ë¡œ ê°„ë‹¨í•˜ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”."></textarea>
        </div>
        <div class="cont-flex">
          <div>
            <label for="recruitCount" class="s-title">ëª¨ì§‘ì¸ì›</label>
            <select name="recruitCount" id="recruitCount">
              <option value="0">ì¸ì› ë¯¸ì •</option>
              <option value="1">1ëª…</option>
              <option value="2">2ëª…</option>
              <option value="3">3ëª…</option>
              <option value="4">4ëª…</option>
              <option value="5">5ëª…</option>
              <option value="6">6ëª…</option>
              <option value="7">7ëª…</option>
              <option value="8">8ëª…</option>
              <option value="9">9ëª…</option>
            </select>
          </div>
          <div>
            <label for="projectPurpose" class="s-title">ìˆ˜í–‰ëª©ì </label>
            <select name="projectPurpose" id="projectPurpose">
              <option value="í¬íŠ¸í´ë¦¬ì˜¤/ì§ë¬´ ì—­ëŸ‰ ê°•í™”">í¬íŠ¸í´ë¦¬ì˜¤/ì§ë¬´ ì—­ëŸ‰ ê°•í™”</option>
              <option value="ì°½ì—…/ìˆ˜ìµ ì°½ì¶œ">ì°½ì—…/ìˆ˜ìµ ì°½ì¶œ</option>
              <option value="ì¬ë¯¸/ë„¤íŠ¸ì›Œí‚¹">ì¬ë¯¸/ë„¤íŠ¸ì›Œí‚¹</option>
            </select>
          </div>
        </div>
        <div class="cont-flex">
          <div>
            <label for="projectTime" class="s-title">ì°¸ì—¬ì‹œê°„</label>
            <select name="projectTime" id="projectTime">
              <option value="1">ë§¤ì£¼ 4ì‹œê°„ ì´í•˜</option>
              <option value="2">ë§¤ì£¼ 4 ~ 10ì‹œê°„</option>
              <option value="3">ë§¤ì£¼ 10ì‹œê°„ ì´ìƒ</option>
            </select>
          </div>
          <div>
            <label for="projectProcess" class="s-title">ì§„í–‰ë°©ì‹</label>
            <select name="projectProcess" id="projectProcess">
              <option value="ëˆë¼ì¸">ì˜¨ë¼ì¸</option>
              <option value="ì˜¤í”„ë¼ì¸">ì˜¤í”„ë¼ì¸</option>
              <option value="ì˜¨/ì˜¤í”„ë¼ì¸">ì˜¨/ì˜¤í”„ë¼ì¸</option>
            </select>
          </div>
        </div>
        <div class="cont-flex">
          <div>
            <label for="exceptDate" class="s-title">ì˜ˆìƒê¸°ê°„</label>
            <select name="exceptDate" id="exceptDate">
              <option value="1">1ê°œì›” ì´í•˜</option>
              <option value="2">2ê°œì›”</option>
              <option value="3">3ê°œì›”</option>
              <option value="4">4ê°œì›”</option>
              <option value="5">5ê°œì›”</option>
              <option value="6">6ê°œì›”</option>
              <option value="7">7ê°œì›”</option>
              <option value="0">ì¥ê¸°</option>
            </select>
          </div>
          <div>
            <label for="exceptTime" class="s-title">ì‹œì‘ì˜ˆì •</label>
            <input type="date" name="exceptTime" id="exceptTime">
          </div>
        </div>
        <div class="cont-flex">
          <div>
            <label for="skill" class="s-title">ê¸°ìˆ ìŠ¤íƒ</label>
            <div class="select-programs" id="skill-container">
              <!--ì•„ì´ì½˜ ë“¤ì–´ê°€ëŠ” ê³³-->
            </div>
            <select id="skill">
              <option value="all">ê¸°ìˆ ìŠ¤íƒ</option>
              <option value="AWS">AWS</option>
              <option value="Docker">Docker</option>
              <option value="Figma">Figma</option>
              <option value="Flutter">Flutter</option>
              <option value="Git">Git</option>
              <option value="Java">Java</option>
              <option value="JavaScript">JavaScript</option>
              <option value="Jest">Jest</option>
              <option value="Kotlin">Kotlin</option>
              <option value="MongoDb">MongoDb</option>
              <option value="MySQL">MySQL</option>
              <option value="Nodejs">Nodejs</option>
              <option value="php">php</option>
              <option value="Python">Python</option>
              <option value="React">React</option>
              <option value="ReactNative">ReactNative</option>
              <option value="Spring">Spring</option>
              <option value="Svelte">Svelte</option>
              <option value="TypeScript">TypeScript</option>
              <option value="Vue">Vue</option>
            </select>
          </div>
          <div>
            <label for="role" class="s-title">ëª¨ì§‘ë¶„ì•¼</label>
            <div class="select-programs" id="role-container">
              <!--ì•„ì´ì½˜ ë“¤ì–´ê°€ëŠ” ê³³-->
            </div>
            <select id="role">
              <option value="all">ì „ì²´</option>
              <option value="í”„ë¡ íŠ¸ì—”ë“œ">í”„ë¡ íŠ¸ì—”ë“œ</option>
              <option value="ë°±ì—”ë“œ">ë°±ì—”ë“œ</option>
              <option value="ë””ìì¸">ë””ìì¸</option>
              <option value="ê¸°íš">ê¸°íš</option>
            </select>
          </div>
        </div>
        <div class="rc-project-info">
          <p class="s-title">ì†Œê°œ</p>
          <textarea cols="40" rows="15" name="projectInfo" placeholder="í”„ë¡œì íŠ¸ ì†Œê°œê¸€ì„ ì‘ì„±í•˜ì„¸ìš”."></textarea>
        </div>
        <div class="open-modal btn-write">ì‘ì„±ì™„ë£Œ</div>
        <!-- ëª¨ë‹¬ì°½ -->
        <div class="modal-bg"></div>
        <div class="modal">
          <div class="modal-header">
            <a href="#" class="close-modal"><i class="fa-solid fa-xmark"></i></a>
          </div>
          <h3>ëª¨ì§‘ê¸€ì„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h3>
          <div class="button-wrap">
            <button class="close-modal">ëŒì•„ê°€ê¸°</button>
            <!-- TODO: <button class="submit-modal" type="submit"> ë°±ì—”ë“œ ì—°ê²° í›„ ìˆ˜ì • -->
            <button class="submit-modal" type="button">
              ë“±ë¡í•˜ê¸°
            </button>
          </div>
        </div>
      </form>
    </div>
    <div class="rc-info">
      <div class="rc-title-info">
        ì œëª©ì€ í”„ë¡œì íŠ¸ë¥¼ ì§ê´€ì ìœ¼ë¡œ ì•Œ ìˆ˜ ìˆê²Œ<br/>
        ì‘ì„±í•´ì£¼ì„¸ìš” (50ìì´ë‚´)
      </div>
      <div class="rc-title-info summarize">
        ì–´ë–¤ í”„ë¡œì íŠ¸ì¸ì§€ ì´í•´í•˜ê¸° ì‰½ë„ë¡ ëª…í™•í•˜ê³  ê°„ê²°í•˜ê²Œ
        ìš”ì•½í•´ì£¼ì„¸ìš”(150ìì´ë‚´)
      </div>
      <div class="advice">
        <div class="advice-step1">
          âœ… ì†Œê°œì—ëŠ” ì´ëŸ° ë‚´ìš©ì´ ìˆìœ¼ë©´ ì¢‹ì•„ìš”ğŸ‘‡
        </div>
        <div class="advice-step2">
          <ul>
            <li>ì–´ë–¤ í”„ë¡œì íŠ¸ì¸ì§€</li>
            <li>í”„ë¡œì íŠ¸ë¥¼ ê¸°íší•œ ë°°ê²½</li>
            <li>í”„ë¡œì íŠ¸ ëª©ì , ë‹¬ì„±í•˜ê³  ì‹¶ì€ ëª©í‘œ</li>
            <li>ëª¨ì§‘í•˜ê³  ì‹¶ì€ ì—­í• ê³¼ ì¸ì›ìˆ˜</li>
            <li>í”„ë¡œì íŠ¸ ì§„í–‰ ë°©ì‹</li>
          </ul>
        </div>
        <div class="advice-step3">
          ì´ë¯¸ ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸ë¼ë©´, í˜„ì¬ êµ¬ì„±ì›ê³¼ ì§„í–‰ìƒí™©ì„ ì•Œë ¤ì£¼ì„¸ìš”
        </div>
      </div>
    </div>
  </div>
  <div class="owner-id" th:text="${session.loginMember.getId()}" style="visibility: hidden"></div>
  <footer>
    <th:block th:replace="~{fragment/footer}"></th:block>
  </footer>
  <script>
      let ownerId = document.querySelector(".owner-id").textContent;
      // í”„ë¡œì íŠ¸ ì£¼ì œ(textarea) : 1ì¤„ë§Œ ì“°ê²Œ ì œí•œ
      document.getElementById('subject').addEventListener('keydown', function (event) {
          if (event.key === 'Enter') {
              event.preventDefault();
          }
      });

      // í”„ë¡œì íŠ¸ ì£¼ì œ(textarea) ì…ë ¥ ì¹¸ : 20ì ê¸€ì ì œí•œ
      document.getElementById('subject').addEventListener('input', function () {
          if (this.value.length > 20) {
              this.value = this.value.slice(0, 20);
          }
      });

      document.querySelector(".open-modal").addEventListener("click", function () {
          document.querySelector(".modal-bg").classList.add("visible");
          document.querySelector(".modal").classList.add("visible");
      });

      document.querySelector(".close-modal").addEventListener("click", function () {
          document.querySelector(".modal-bg").classList.remove("visible");
          document.querySelector(".modal").classList.remove("visible");
      });

      // ë°ì´í„° ì „ì†¡
      document.querySelector(".submit-modal").addEventListener("click", function () {
          event.preventDefault(); // form ì „ì†¡ ë§‰ëŠ” ì½”ë“œ

          let formData = $("#createProject").serializeArray();
          let jsonData = {};

          $(formData).each(function (index, obj) {
            // ì¤„ë°”ê¿ˆì„ <br>ë¡œ ë³€í™˜
            if (obj.name === "projectInfo") {
              obj.value = obj.value.replace(/\n/g, "<br />");
            }
            jsonData[obj.name] = obj.value;
          });

          // ë‚ ì§œê°€ ì˜¤ëŠ˜ ë‚ ì§œë³´ë‹¤ ì ìœ¼ë©´ ì•ˆë¨.
          let selectDate = new Date(jsonData.exceptTime);
          let today = new Date();
          today.setHours(0, 0, 0, 0);
          if (selectDate < today) {
              alert('ì„ íƒí•˜ì‹  ë‚ ì§œëŠ” ì˜¤ëŠ˜ ë‚ ì§œë³´ë‹¤ ì´ì „ì…ë‹ˆë‹¤ !');
              document.querySelector(".modal-bg").classList.remove("visible");
              document.querySelector(".modal").classList.remove("visible");
          } else {
              jsonData.skills = [];

              document.querySelectorAll(".selected-skill").forEach((skill) => {
                  jsonData.skills.push(skill.id);
              })

              jsonData.recruitRole = [];
              document.querySelectorAll(".selected-role").forEach((role) => {
                  jsonData.recruitRole.push(role.id);
              })

              jsonData.ownerId = ownerId;

              $.ajax({
                  type: "post",
                  url: "/api/project",
                  data: JSON.stringify(jsonData),
                  contentType: "application/json; charset=utf-8",
                  dataType: "json"
              }).done(res => { // HttpStatus 200ë²ˆëŒ€
                  console.log("ì„±ê³µ", res);
                  let projectId = res.data;
                  alert("ë©¤ë²„ ëª¨ì§‘ì´ ì •ìƒì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.")

                  window.location.assign(`/project/${projectId}`);
              }).fail(error => { // HttpStatus 200ë²ˆëŒ€ê°€ ì•„ë‹ë•Œ
                  alert("í”„ë¡œì íŠ¸ ì‘ì„±ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤!")
              });
          }
      });

      document.addEventListener("click", function (event) {
          if (
              !event.target.closest(".modal, .open-modal, .open-modal02, .open-modal03")
          ) {
              document.querySelector(".modal").classList.remove("visible");
              document.querySelector(".modal-bg").classList.remove("visible");
              document.body.classList.remove("modal-open");
          }

      });


  </script>
</main>
</body>
</html>